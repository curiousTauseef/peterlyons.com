extends ../site/layout
block variables
  - title = gallery.displayName
block body
  h1 New Photos are on Flickr
  p.
    Note that starting in the fall of 2011,
    my photos are available on
    <a href="http://www.flickr.com/photos/88096431@N00/">my Flickr photo stream</a>.
    I enjoyed writing and maintaining my own photo software for a decade or so,
    but it's time to move on.
  .galleryApp(ng-app="photos", ng-controller="galleryController", ng-cloak)
    h1 Photo Gallery: {{gallery.displayName}}
    #nextPrev
      a(href="{{previousPhoto.pageURI}}", ng-if="previousPhoto") &lt;&lt;previous&nbsp;
      a(href="{{nextPhoto.pageURI}}", ng-if="nextPhoto") next&gt;&gt;
    figure
      img(src="{{photo.fullSizeURI}}",
        alt="{{photo.caption}}", title="{{photo.caption}}")
      figcaption {{photo.caption}}
    a.thumbnail(ng-repeat="photo in gallery.photos", href="{{photo.pageURI}}")
      img.thumbnail(src="{{photo.thumbnailURI}}",
        alt="{{photo.caption}}", title="{{photo.caption}}")
    nav.photos
      div(ng-repeat="year in years")
        h2.year {{year.name}}
        a.gallerylink(ng-repeat="gallery in year.galleries",
          href="?gallery={{gallery.dirName}}") {{gallery.displayName}}

block append scripts
  script(src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.8/angular.min.js")
  script(src="/photos/viewGallery.js")
  :coffeescript
    $ ->
      $("a.thumbnail").click (event)->
        event.preventDefault()
        $("#photo").attr "src", $(this).attr("data-fullSizeURI")
        $("#photo").attr "alt", $(this).attr("data-caption")
        $("#photo").attr "title", $(this).attr("data-caption")
        $("#caption").text $(this).attr("data-caption")
        #Have to omit any literal ampersand here or zombie chokes.
        #https://github.com/assaf/zombie/issues/62/#comment_952554
        #String.fromCharCode(38) is an ampersand
        photoURI = $(".galleryName").attr("data-galleryURI") + "&photo=" + $(this).attr("data-name")
        $("#photolink").attr "href", photoURI
        window.scrollTo 0, $("#photo").position().top - 5
